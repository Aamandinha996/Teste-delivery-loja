<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Calculadora Delivery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background:#f7f9fc; padding:20px; color:#222; }
    .card { max-width:520px; margin:0 auto; background:white; padding:20px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
    input { width:100%; padding:10px; margin:8px 0; border-radius:6px; border:1px solid #ddd; }
    button { padding:10px 14px; border-radius:8px; border:none; background:#2b7de9; color:white; cursor:pointer; }
    .small { font-size:0.9rem; color:#666; margin-top:8px; }
    pre { background:#111; color:#bfe; padding:10px; border-radius:6px; overflow:auto; max-height:180px; }
  </style>
</head>
<body>
  <div class="card">
    <h2>ðŸ“¦ Calculadora de Delivery</h2>
    <p><strong>Origem (loja):</strong> Estrada dos Mirandas, SÃ£o Paulo - SP</p>

    <label>CEP (somente nÃºmeros):</label>
    <input id="cep" placeholder="Ex: 01234567">

    <label>NÃºmero da casa:</label>
    <input id="numero" placeholder="Ex: 100">

    <button onclick="calcularDelivery()" style="margin-top:10px;">Calcular Delivery</button>

    <p id="resultado" class="small"></p>
  </div>

  <script>
    const lojaEndereco = "Estrada dos Mirandas, SÃ£o Paulo - SP";
    const precoPorBloco = 8; // R$8
    const kmPorBloco = 5;    // cada 5 km

    function cleanCEP(raw) {
      return (raw || '').replace(/\D/g, '');
    }

    function geocodeAddress(address) {
      return new Promise((resolve, reject) => {
        if (!window.google || !google.maps || !google.maps.Geocoder) {
          reject('Google Maps JS nÃ£o carregado.');
          return;
        }
        const geocoder = new google.maps.Geocoder();
        geocoder.geocode({ address: address }, (results, status) => {
          if (status === 'OK' && results[0]) resolve(results[0]);
          else reject('Falha ao localizar endereÃ§o: ' + status);
        });
      });
    }

    function calcPriceFromKm(distKm) {
      return Math.ceil(distKm / kmPorBloco) * precoPorBloco;
    }

    function callDistanceMatrix(originAddress, destAddress) {
      return new Promise((resolve, reject) => {
        const service = new google.maps.DistanceMatrixService();
        service.getDistanceMatrix({
          origins: [originAddress],
          destinations: [destAddress],
          travelMode: 'DRIVING',
          unitSystem: google.maps.UnitSystem.METRIC
        }, (response, status) => {
          if (status !== 'OK') reject('Erro DistanceMatrix: ' + status);
          else resolve(response);
        });
      });
    }

    async function calcularDelivery() {
      const cep = document.getElementById('cep').value.trim();
      const numero = document.getElementById('numero').value.trim();
      const output = document.getElementById('resultado');
      output.textContent = 'Calculando...';

      if (!cep || !numero) {
        output.textContent = 'Por favor, preencha CEP e nÃºmero da casa.';
        return;
      }

      const destino = cep + ', ' + numero + ', Brasil';

      try {
        const geocode = await geocodeAddress(destino);
        const destFormatted = geocode.formatted_address;

        const dm = await callDistanceMatrix(lojaEndereco, destFormatted);
        const elemento = dm.rows[0].elements[0];

        if (elemento.status !== 'OK') {
          output.textContent = 'NÃ£o foi possÃ­vel calcular a distÃ¢ncia. Verifique o CEP e nÃºmero.';
          return;
        }

        const distanciaKm = elemento.distance.value / 1000;
        const distanciaTexto = elemento.distance.text;
        const preco = calcPriceFromKm(distanciaKm);

        output.innerHTML = `ðŸš— DistÃ¢ncia: <strong>${distanciaTexto}</strong><br>ðŸ’° Valor do delivery: <strong>R$ ${preco},00</strong>`;
      } catch (err) {
        output.textContent = 'Erro: ' + err;
      }
    }
  </script>

  <!-- Google Maps API -->
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDiyfkCBwncJwOFA9lZ5Ng6W3M_qvQuVtQ&libraries=places"></script>
</body>
</html>

